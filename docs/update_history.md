# 更新履歴

## 2025-03-09 UI改善アップデート

### 1. スケジュール登録フォームの改善

#### 日付選択の改善
- カレンダーマークをクリックしなくても日付を選択できるように改善
- 日付フィールドをクリックするだけでカレンダーが表示されるようにjQuery UIのDatepickerを実装
- 日本語対応のカレンダーを実装（曜日や月名が日本語で表示）
- 日付フィールドにはカレンダーアイコンを表示し、クリック可能であることを明示
- 日付選択フィールドを読み取り専用に設定し、手動入力によるエラーを防止

#### 不要なフィールドの削除
- 開始時間と終了時間のフィールドを完全に削除
- バックエンド（routes.py）も更新して、これらのフィールドを処理しないように変更

#### その他の改善
- ポート番号を指定できるようにrun.pyを修正（ポートが使用中の場合に別のポートで起動可能）
- 入力フィールドの高さと内部パディングを増加（44pxの最小高さを設定）
- フォントサイズを16pxに拡大（モバイルでの自動ズームを防止）
- フォーカス時の視覚的なフィードバックを追加（青い枠とシャドウ）
- ボタンのサイズを大きく（幅と高さ）
- パディングと余白を増加
- モバイル対応の強化（画面幅が768px以下の場合、さらに大きなタッチターゲットを提供）

### 2. 作付け計画なしでのスケジュール登録機能

#### データモデルの変更
- Scheduleモデルのplan_idフィールドをnullable=Trueに変更し、作付け計画なしでもスケジュールを登録できるように

#### テンプレートの変更
- 作付け計画がない場合でもフォームフィールドを有効化
- 警告メッセージを情報メッセージに変更
- 作付け計画と圃場選択の連動処理を実装（作付け計画が選択されている場合は圃場選択を無効化）

#### ルートハンドラの変更
- 作付け計画IDが空の場合はNoneに変換するロジックを追加
- 圃場IDの処理を追加

## 2025-03-09 作物の栽培ステージ管理機能の実装

### 1. 作物ステージモデルの追加

#### データモデルの実装
- `CropStage` モデルを追加し、作物の栽培ステージを管理
- ステージ名、開始日からの日数、説明、表示順序を保存
- `Crop` モデルとのリレーションシップを確立

#### マイグレーションの実装
- データベースマイグレーションを作成し、テーブル構造を更新

### 2. 作物登録・編集画面の拡張

#### ユーザーインターフェースの実装
- 作物登録フォームにステージ管理セクションを追加
- ステージの動的な追加・削除・並び替え機能をJavaScriptで実装
- 各ステージの名前、開始日からの日数、説明を入力可能

#### バックエンド処理の実装
- フォーム送信時にステージ情報を処理するロジックを追加
- 編集時に既存ステージの更新や削除を処理

### 3. 作付け計画との連携機能

#### 自動スケジュール生成
- 作付け計画作成時に、選択した作物のステージ情報に基づいて作業予定を自動生成
- 各ステージの日数を開始日から計算し、予定日を自動設定

#### 作付け計画編集時のスケジュール再生成
- 作付け計画の作物や開始日が変更された場合、スケジュールを再生成するオプションを実装

### 4. バグ修正とUI改善

#### カレンダー表示の修正
- 作付け計画がないスケジュールもカレンダーに表示できるように修正
- トップページの予定表示を修正

#### ダッシュボードUIの改善
- トップページから圃場一覧セクションを削除し、シンプルなレイアウトに改善

## 今後の予定機能

### 資材管理機能

#### 概要
- 資材の在庫管理と登録機能
- 作業予定と連携した資材使用計画
- 資材の発注・入荷管理
- 作付け計画登録時に、関連するステージ情報に基づいて作業予定を自動生成
- 各ステージの予定日を視覚的に表示

#### 技術的な詳細
- CropStageモデルの追加（作物ID、ステージ名、開始日からの日数、説明、順序）
- 作物とステージの関連付け
- 日付計算ロジックの実装
- 動的なフォーム操作のためのJavaScript実装
